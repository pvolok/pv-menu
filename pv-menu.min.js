(function(c){function e(a,b,f){var d=this;this.a=a;this.o=b;this.c=c.extend({},p,b,f);this.e=this.d=null;this.b=!0;a.on("mouseenter mouseleave",function(a){c(d).trigger(a.type+"_")});if("click"!=this.c.trigger)c(this).on("mouseenter_",function(){d.parentNode||clearTimeout(d.n)}).on("mouseleave_",function(){d.parentNode||(d.n=setTimeout(function(){d.g();c(d).trigger("menuclose")},300))});this.m();"delay"==this.c.trigger?this.l():"click"==this.c.trigger&&this.k();a.on("click",this.c.item_selector,function(a){c(d).trigger({type:"action",
originalEvent:a,closeMenu:c.proxy(d.f,d)})})}var p={item_selector:".menuitem",position:{my:"left top",at:"right top"}};e.prototype.m=function(){var a=this,b=this.c;this.a.on("mouseenter",b.item_selector,function(){var b=c(this);a.g();a.e=b;a.b&&a.j();b.data("submenu")||b.addClass("active")});this.a.on("mouseleave",b.item_selector,function(){a.e.data("submenu")||a.e.removeClass("active")})};e.prototype.l=function(){var a=this,b=this.c,f;a.b=!1;this.a.on("mouseenter",b.item_selector,function(){a.b||
(f=setTimeout(function(){a.b=!0;a.j()},300))});this.a.on("mouseleave",b.item_selector,function(){clearTimeout(f)});c(this).on("menuclose",function(){a.b=!1})};e.prototype.k=function(){var a=this,b=this.c;a.b=!1;this.h=function(b){b.preventDefault();b=c(document);a.j();a.b=!0;b.on("click",function(b){a.i(b.target)||(a.b=!1,a.f())})};this.a.on("click",b.item_selector,this.h)};e.prototype.j=function(){var a=this.e,b=a.data("submenu");a.addClass("active");b&&("string"===typeof b&&(b=c(b).menu(this.o).data("menu"),
a.data("submenu",b)),this.d=b,b.parentNode=this,b.a.appendTo(document.body).show().position(c.extend({of:a},this.c.position)))};e.prototype.g=function(){this.e&&this.e.removeClass("active");this.d&&(this.d.parentNode=null,this.d.close(),this.d=null)};e.prototype.close=function(){this.a.hide();this.g()};e.prototype.f=function(){this.parentNode?this.parentNode.f():(this.g(),this.h&&c(document).off("click",this.h))};e.prototype.i=function(a){return this.a[0]==a||c.contains(this.a[0],a)||this.d&&this.d.i(a)};
c.fn.menu=function(a,b){var c=this.data("menu");c||(c=new e(this,a,b),this.data("menu",c));return this};c.fn.contextMenu=function(a){function b(b){a.i(b.target)||e.f()}var e={f:function(){b&&c(document).off("click",b);a.close();a.parentNode=null}};this.data("menu",e);a=c(a).menu({}).data("menu");this.on("contextmenu",function(d){d.preventDefault();var g=c(window),h=a.a,k=d.pageX,l=d.pageY;h.appendTo(document.body).show();a.parentNode=e;var m=h.outerWidth(),n=h.outerHeight();d.clientX+m>g.width()&&
(k=Math.max(k-m,g.scrollLeft()));d.clientY+n>g.height()&&(l=Math.max(l-n,g.scrollTop()));h.css({left:k,top:l});c(document).on("click",b)});return this}})(jQuery);
